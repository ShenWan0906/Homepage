---
// 引入刚刚分离的数据文件
import { photos, categories } from "../components/photos.ts";
---

<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>光影浮生 | 西瓜的摄影展</title>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      body {
        /* 使用极深的灰黑色作为摄影展背景，最能凸显照片色彩 */
        background-color: #0a0a0c;
        color: #e5e7eb;
      }
      ::-webkit-scrollbar {
        width: 6px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #333;
        border-radius: 4px;
      }

      /* 隐藏弹窗默认背景 */
      dialog::backdrop {
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(8px);
      }
    </style>
  </head>

  <body class="min-h-screen antialiased">
    <main
      class="max-w-[1400px] mx-auto flex flex-col lg:flex-row py-8 px-4 sm:px-8 gap-8 lg:gap-12"
    >
      <aside
        class="lg:w-[340px] flex-shrink-0 flex flex-col lg:sticky lg:top-12 h-fit gap-6"
      >
        <div
          class="bg-white/5 border border-white/10 rounded-3xl p-6 backdrop-blur-md flex flex-col items-center text-center shadow-2xl relative z-10"
        >
          <div
            class="w-28 h-28 rounded-full overflow-hidden border-2 border-zinc-700 mb-4 relative group"
          >
            <img
              src="/icons/demo-avatar.png"
              alt="西瓜"
              class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
            />
          </div>

          <h2
            class="text-3xl font-bold tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-gray-800 to-gray-500 dark:from-white dark:to-gray-400"
          >
            光影浮生
          </h2>
          <p class="text-xs font-mono text-zinc-400 mb-4">@西瓜</p>

          <p class="text-sm text-zinc-300 leading-relaxed mb-6">
            项目经理 / 独立开发者<br />
            <span class="text-zinc-500 text-xs mt-2 block"
              >"用镜头记录人间烟火，定格那些不经意的瞬间。"</span
            >
          </p>

          <div
            class="w-full h-px bg-gradient-to-r from-transparent via-zinc-700 to-transparent mb-6"
          >
          </div>

          <div
            class="flex items-center gap-2 text-xs font-mono text-zinc-400 bg-black/30 px-3 py-1.5 rounded-full border border-zinc-800 w-full justify-center mb-4"
          >
            <i class="fa-solid fa-camera text-zinc-500"></i> Canon EOS 800D
          </div>

          <a
            href="http://shenwan.life/"
            class="w-full py-2.5 rounded-xl bg-white text-black hover:bg-zinc-200 transition-colors text-sm font-bold flex items-center justify-center gap-2"
          >
            <i class="fa-solid fa-arrow-left"></i> 前往主站
          </a>
        </div>

        <div
          class="bg-gradient-to-br from-zinc-800/60 to-black/60 border border-white/10 rounded-3xl p-6 backdrop-blur-md flex flex-col items-center text-center shadow-2xl relative overflow-hidden group z-10"
        >
          <i
            class="fa-brands fa-github absolute -bottom-6 -right-6 text-[100px] text-white/5 group-hover:scale-110 group-hover:text-white/10 transition-all duration-500 pointer-events-none"
          ></i>

          <h3
            class="text-white font-bold text-base mb-2 flex items-center gap-2 z-10"
          >
            <i class="fa-solid fa-code-branch text-zinc-400"></i> 获取画廊源码
          </h3>

          <p class="text-xs text-zinc-400 leading-relaxed mb-5 z-10">
            这个极简光影集已在 GitHub 彻底开源。喜欢这个设计的话，欢迎去赏个
            Star ⭐️！
          </p>

          <a
            href="https://github.com/ShenWan0906/Homepage"
            target="_blank"
            class="w-full py-2.5 rounded-xl bg-[#24292F] hover:bg-[#1f2328] border border-zinc-600 hover:border-zinc-500 text-white transition-all text-sm font-bold flex items-center justify-center gap-2 shadow-lg z-10"
          >
            <i class="fa-brands fa-github text-lg"></i> 去 GitHub 围观
          </a>
        </div>
      </aside>

      <section class="flex-1 w-full pb-20">
        <div
          class="flex flex-col sm:flex-row items-center justify-between gap-4 mb-8 bg-white/5 border border-white/10 p-2 rounded-2xl backdrop-blur-sm"
        >
          <div class="flex flex-wrap items-center gap-1" id="filter-container">
            {
              categories.map((cat, index) => (
                <button
                  class={`filter-btn px-4 py-1.5 rounded-xl text-sm transition-all ${index === 0 ? "bg-zinc-700 text-white font-bold" : "text-zinc-400 hover:text-white hover:bg-white/10"}`}
                  data-filter={cat}
                >
                  {cat}
                </button>
              ))
            }
          </div>

          <div
            class="flex items-center bg-black/40 rounded-xl p-1 border border-zinc-800"
          >
            <button
              class="sort-btn active px-3 py-1.5 rounded-lg text-sm text-white font-bold bg-zinc-800"
              data-sort="default"
            >
              <i class="fa-solid fa-clock mr-1"></i> 最新
            </button>
            <button
              class="sort-btn px-3 py-1.5 rounded-lg text-sm text-zinc-400 hover:text-white transition-colors"
              data-sort="likes"
            >
              <i class="fa-solid fa-fire mr-1"></i> 最热
            </button>
          </div>
        </div>

        <div
          class="columns-1 sm:columns-2 xl:columns-3 gap-6 space-y-6 min-h-[70vh] transition-all duration-300 ease-in-out"
          id="photo-grid"
        >
          {
            photos.map((photo) => (
              <div
                class="photo-card break-inside-avoid relative group rounded-2xl overflow-hidden bg-zinc-900 border border-zinc-800 cursor-zoom-in shadow-lg"
                data-category={photo.category}
                data-likes={photo.likes}
                onclick={`openLightbox('${photo.src}', '${photo.title}', '${photo.exif}')`}
              >
                <img
                  src={photo.src}
                  alt={photo.title}
                  class="w-full h-auto transform group-hover:scale-[1.03] transition-transform duration-700 will-change-transform"
                  loading="lazy"
                />

                <button
                  class="absolute top-4 right-4 z-20 flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-black/40 backdrop-blur-md text-zinc-300 hover:text-red-500 hover:bg-black/60 border border-white/10 transition-all shadow-md"
                  onclick="event.stopPropagation(); toggleLike(this)"
                >
                  <i class="fa-solid fa-heart" />
                  <span class="text-xs font-mono like-count">
                    {photo.likes}
                  </span>
                </button>

                <div class="absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent p-5 opacity-100 group-hover:opacity-0 transition-all duration-500 pointer-events-none z-10 flex flex-col justify-end h-1/2">
                  <div class="flex flex-col translate-y-0 group-hover:translate-y-3 transition-transform duration-500">
                    <div class="mb-1.5 flex items-center gap-2">
                      <span class="px-2 py-0.5 rounded text-[10px] bg-white/20 text-white backdrop-blur-sm border border-white/10 shadow-sm">
                        {photo.category}
                      </span>
                      <h3 class="text-white font-bold text-lg drop-shadow-md">
                        {photo.title}
                      </h3>
                    </div>
                    <p class="text-zinc-300 text-xs font-mono mt-1 border-l-2 border-zinc-500/80 pl-2 drop-shadow-md">
                      {photo.exif}
                    </p>
                  </div>
                </div>
              </div>
            ))
          }
        </div>

        <div id="empty-state" class="hidden text-center py-20 text-zinc-500">
          <i class="fa-solid fa-camera-rotate text-4xl mb-4 opacity-50"></i>
          <p>该分类下暂无照片</p>
        </div>
      </section>
    </main>

    <dialog
      id="lightbox"
      class="m-0 w-full h-full max-w-none max-h-none bg-transparent"
    >
      <div
        class="flex flex-col items-center justify-center w-full h-full p-4 relative cursor-zoom-out"
        onclick="closeLightbox(event)"
      >
        <div
          class="absolute top-4 left-0 right-0 px-6 flex justify-between items-center z-50"
        >
          <div class="text-white">
            <h3
              id="lb-title"
              class="text-xl font-bold shadow-black drop-shadow-lg"
            >
            </h3>
            <p
              id="lb-exif"
              class="text-sm font-mono text-zinc-300 shadow-black drop-shadow-lg mt-1"
            >
            </p>
          </div>
          <div class="flex gap-4">
            <a
              id="lb-download"
              href="#"
              download
              class="w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 text-white backdrop-blur-md flex items-center justify-center transition-colors border border-white/20 cursor-pointer"
              title="下载原图"
            >
              <i class="fa-solid fa-download"></i>
            </a>
            <button
              class="w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 text-white backdrop-blur-md flex items-center justify-center transition-colors border border-white/20 cursor-pointer"
              title="关闭"
            >
              <i class="fa-solid fa-xmark text-xl"></i>
            </button>
          </div>
        </div>

        <img
          id="lb-img"
          src=""
          class="max-w-[95vw] max-h-[90vh] object-contain rounded-lg shadow-2xl pointer-events-none"
        />
      </div>
    </dialog>

    <script is:inline>
      // 1. Lightbox (画中画) 逻辑
      const dialog = document.getElementById("lightbox");
      const lbImg = document.getElementById("lb-img");
      const lbTitle = document.getElementById("lb-title");
      const lbExif = document.getElementById("lb-exif");
      const lbDownload = document.getElementById("lb-download");

      function openLightbox(src, title, exif) {
        lbImg.src = src;
        lbTitle.innerText = title;
        lbExif.innerText = exif;
        // 简单实现下载：将 href 指向图片源
        lbDownload.href = src;
        dialog.showModal();
      }

      function closeLightbox(event) {
        // 点击背景或关闭按钮时关闭弹窗
        if (
          event.target === dialog ||
          event.target.closest("div.cursor-zoom-out")
        ) {
          dialog.close();
        }
      }

      // 2. 分类筛选逻辑 (加入淡入动画优化)
      const filterBtns = document.querySelectorAll(".filter-btn");
      const photoCards = document.querySelectorAll(".photo-card");
      const emptyState = document.getElementById("empty-state");

      filterBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
          // 更新按钮样式
          filterBtns.forEach((b) => {
            b.classList.remove("bg-zinc-700", "text-white", "font-bold");
            b.classList.add("text-zinc-400");
          });
          btn.classList.add("bg-zinc-700", "text-white", "font-bold");
          btn.classList.remove("text-zinc-400");

          const targetCat = btn.getAttribute("data-filter");
          let visibleCount = 0;

          photoCards.forEach((card) => {
            const cardCat = card.getAttribute("data-category");

            // 先去掉之前的动画类
            card.style.animation = "none";

            if (targetCat === "全部" || cardCat === targetCat) {
              card.style.display = "block";
              visibleCount++;

              // 触发浏览器的重绘 (Reflow) 以便重新播放动画
              card.offsetHeight;
              // 加入简单的淡入+微上浮动画
              card.style.animation = "fadeInUp 0.5s ease forwards";
            } else {
              card.style.display = "none";
            }
          });

          // 显示空状态
          emptyState.style.display = visibleCount === 0 ? "block" : "none";
        });
      });

      // 在 JS 里直接注入这个极简的动画 CSS
      const style = document.createElement("style");
      style.textContent = `
            @keyframes fadeInUp {
                from { opacity: 0; transform: translateY(15px); }
                to { opacity: 1; transform: translateY(0); }
            }
        `;
      document.head.appendChild(style);

      // 3. 排序逻辑
      const sortBtns = document.querySelectorAll(".sort-btn");
      const photoGrid = document.getElementById("photo-grid");

      sortBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
          // 更新按钮样式
          sortBtns.forEach((b) => {
            b.classList.remove("bg-zinc-800", "text-white", "font-bold");
            b.classList.add("text-zinc-400");
          });
          btn.classList.add("bg-zinc-800", "text-white", "font-bold");
          btn.classList.remove("text-zinc-400");

          const sortType = btn.getAttribute("data-sort");
          const cardsArray = Array.from(photoCards);

          if (sortType === "likes") {
            // 按点赞数从高到低排序
            cardsArray.sort((a, b) => {
              return (
                parseInt(b.getAttribute("data-likes")) -
                parseInt(a.getAttribute("data-likes"))
              );
            });
          } else {
            // 默认排序 (按 DOM 原始顺序恢复，这里简单刷新页面或用 data-index 恢复，为简化直接保留原样)
            // 实际应用中可以在 photos.ts 里加个 ID，按 ID 排序恢复
            cardsArray.sort((a, b) => {
              return 0; // 这里的简化处理：如果需要绝对的“最新”排序，建议在数据层直接按日期排好。
            });
          }

          // 重新插入 DOM 以实现排序
          cardsArray.forEach((card) => photoGrid.appendChild(card));
        });
      });

      // 4. 点赞视觉效果模拟
      function toggleLike(btn) {
        const icon = btn.querySelector("i");
        const countSpan = btn.querySelector(".like-count");
        let count = parseInt(countSpan.innerText);

        if (btn.classList.contains("text-red-500")) {
          // 取消赞
          btn.classList.remove("text-red-500");
          btn.classList.add("text-zinc-300");
          icon.classList.remove("fa-solid");
          icon.classList.add("fa-regular"); // 变成空心
          countSpan.innerText = count - 1;
        } else {
          // 点赞
          btn.classList.remove("text-zinc-300");
          btn.classList.add("text-red-500");
          icon.classList.remove("fa-regular");
          icon.classList.add("fa-solid"); // 变成实心
          countSpan.innerText = count + 1;

          // 加个小动画
          icon.style.transform = "scale(1.3)";
          setTimeout(() => (icon.style.transform = "scale(1)"), 200);
        }
      }
    </script>
  </body>
</html>
